/* CDP-Template 2015-03-31 */
!function(a,b){"function"==typeof define&&define.amd?define(["cdp.tools.proxy","cdp.tools.container"],function(){return b(a.CDP||(a.CDP={}))}):b(a.CDP||(a.CDP={}))}(this,function(a){a.SlideShow=a.SlideShow||{};var a;!function(a){var b;!function(b){var c=function(){function b(a,b,c,d,e,f,g,h){this._enableFade=a,this._opacity=b,this._enableTransform=c,this._scaleX=d,this._scaleY=e,this._translateX=f,this._translateY=g,this._cssPrefixes=h}return b.prototype.getFadeProperty=function(a){if(!this._enableFade)return-1;var b=this._opacity.start+a*this._opacity.distance;return this._opacity.start<this._opacity.end?this._opacity.end<b&&(b=this._opacity.end):this._opacity.end>b&&(b=this._opacity.end),b},b.prototype.getTransformProperty=function(a){if(!this._enableTransform)return!1;var b=this._scaleX.start+a*this._scaleX.distance;this._scaleX.start<this._scaleX.end?this._scaleX.end<b&&(b=this._scaleX.end):this._scaleX.end>b&&(b=this._scaleX.end);var c=this._scaleY.start+a*this._scaleY.distance;this._scaleY.start<this._scaleY.end?this._scaleY.end<c&&(c=this._scaleY.end):this._scaleY.end>c&&(c=this._scaleY.end);var d=this._translateX.start+Math.floor(a*this._translateX.distance);this._translateX.start<this._translateX.end?this._translateX.end<d&&(d=this._translateX.end):this._translateX.end>d&&(d=this._translateX.end);var e=this._translateY.start+Math.floor(a*this._translateY.distance);this._translateY.start<this._translateY.end?this._translateY.end<e&&(e=this._translateY.end):this._translateY.end>e&&(e=this._translateY.end);for(var f="scale("+b+","+c+") translate("+d+"px,"+e+"px)",g={},h=0;h<this._cssPrefixes.length;h++)g[this._cssPrefixes[h]+"transform"]=f;return g},b.start=function(a,c,d){var e=$.Deferred();null==c&&(c=0),null==d&&(d=0);var f=d>=c?d:c;if(!a||!a.$element||0>=f)return e.resolve();var g=b.createTimerAnimationInfo(a,c,d);if(!g)return e.resolve();var h=function(){e.resolve()},i=function(a,b){if("transform"===b.prop){var c=b.end.info.getTransformProperty(b.pos);c&&$(b.elem).css(c)}if("fade"===b.prop){var d=b.end.info.getFadeProperty(b.pos);d>=0&&$(b.elem).css("opacity",d)}};return a.$element.animate(g,{duration:f,easing:"linear",complete:h,step:i}),e.promise()},b.createTimerAnimationInfo=function(c,d,e){var f=1,g=1,h=0,i=0,j=1,k=1,l=1,m=0,n=0,o=1,p=0,q=0,r=0,s=0,t=0,u=1,v=1;if(d>0&&e>0&&d!==e&&(e>d?u=e/d:v=d/e),c.transform){var w=c.transform.start&&c.transform.start.transform?c.transform.start.transform:"",x=c.transform.end&&c.transform.end.transform?c.transform.end.transform:"",y=w.match(/scale\(..*,..*\)/);y&&y[0]&&(f=1*y[0].substring(y[0].indexOf("(")+1,y[0].indexOf(",")),g=1*y[0].substring(y[0].indexOf(",")+1,y[0].indexOf(")")));var z=x.match(/scale\(..*,..*\)/);z&&z[0]&&(k=1*z[0].substring(z[0].indexOf("(")+1,z[0].indexOf(",")),l=1*z[0].substring(z[0].indexOf(",")+1,z[0].indexOf(")"))),null!=f&&null!=k&&(p=(k-f)*v),null!=g&&null!=l&&(q=(l-g)*v);var A=null,B=w.match(/translate\(..*,..*\)/);B&&B[0]&&(A=B[0].replace(/px/g,""),h=1*A.substring(A.indexOf("(")+1,A.indexOf(",")),i=1*A.substring(A.indexOf(",")+1,A.indexOf(")")));var C=x.match(/translate\(..*,..*\)/);C&&C[0]&&(A=C[0].replace(/px/g,""),m=1*A.substring(A.indexOf("(")+1,A.indexOf(",")),n=1*A.substring(A.indexOf(",")+1,A.indexOf(")"))),null!=h&&null!=m&&(r=(m-h)*v),null!=i&&null!=n&&(s=(n-i)*v)}c.fade&&(c.fade.start&&(j=1*c.fade.start.opacity),c.fade.end&&(o=1*c.fade.end.opacity,t=(o-j)*u));var D=new b(!!c.fade,{start:j,end:o,distance:t},!!c.transform,{start:f,end:k,distance:p},{start:g,end:l,distance:q},{start:h,end:m,distance:r},{start:i,end:n,distance:s},a.Tools.CSS.cssPrefixes);return{fade:{info:D},transform:{info:D}}},b}();b.TimerAnimationInfo=c}(b=a.SlideShow||(a.SlideShow={}))}(a||(a={}));var a;!function(a){var b;!function(b){var c=a.Tools.CSS,d="[CDP.SlideShow.Transition] ",e=function(){function a(){}return Object.defineProperty(a,"imageOffset",{get:function(){return a.s_imageOffset},enumerable:!0,configurable:!0}),a.slideIn=function(b,d,e,f){var g=e&&e.direction?e.direction:"left",h=e&&e.duration?e.duration:500,i=e&&e.offset?e.offset:a.s_imageOffset,j=e&&e.focusDuration?e.focusDuration:1500;if(f)return e.fadeDuration=h/2,a.kenBurn(b,d,e,f);var k=a.initViewport(b,d),l=("left"===g?-1:1)*(i+$(k).width()),m=c.getCssMatrixValue($(k),"translateX"),n=c.getCssMatrixValue($(k),"translateY"),o=c.getCssMatrixValue($(k),"scaleX"),p={$element:$(k),transform:a.createTransformProperty(o,m,n,o,l,n)},q=("left"===g?1:-1)*(i+$(k).width()),r={$element:$(d),transform:a.createTransformProperty(1,q,0,1,0,0)},s={viewport:b,oldTarget:p,newTarget:r,transformDuration:h,transformTimingFunction:"ease-out",focusDuration:j};return s},a.fadeIn=function(b,c,d,e){var f=d&&d.duration?d.duration:1e3,g=d&&d.focusDuration?d.focusDuration:1500,h=a.initViewport(b,c),i=null;e||(i={$element:$(h),fade:a.createFadeProperty(1,0),transform:a.createHardwareAcceleratorProperty(h)});var j={$element:$(c),fade:a.createFadeProperty(0,1),transform:a.createHardwareAcceleratorProperty()},k={viewport:b,oldTarget:i,newTarget:j,fadeDuration:f,fadeTimingFunction:"ease-in-out",focusDuration:g};return k},a.kenBurn=function(b,c,d,e){var f=d&&d.type?d.type:"zoomin",g=d&&d.scale?d.scale:1.5,h=d&&d.offsetX?d.offsetX:50,i=d&&d.offsetY?d.offsetY:50,j=d&&d.duration?d.duration:4e3,k=d&&d.focusDuration?d.focusDuration:500,l=d&&d.transformDuration?d.transformDuration:j,m=d&&d.fadeDuration?d.fadeDuration:2e3,n=a.initViewport(b,c),o=null;e||0===m||(o={$element:$(n),fade:a.createFadeProperty(1,0),transform:a.createHardwareAcceleratorProperty(n)});var p=null,q=null;switch(0!==m&&(p=a.createFadeProperty(.3,1)),f){case"zoomout":q=a.createTransformProperty(g,0,0,1,0,0);break;case"zoomin":q=a.createTransformProperty(1,0,0,g,0,0);break;case"slideright":q=a.createTransformProperty(g,-h,i,g,h,0);break;case"slideleft":q=a.createTransformProperty(g,h,i,g,-h,0)}var r={$element:$(c),fade:p,transform:q},s={viewport:b,oldTarget:o,newTarget:r,fadeDuration:m,transformDuration:l,focusDuration:k};return s},a.fixedFadeInZoomOutInscribed=function(b,c,e,f){return a.fixedFadeInZoomOutCommon(b,c,e,f,function(a,b,c,e){var f=1;return 0!==c&&0!==e?f=c>=e?a/c:b/e:console.error(d+"invalid image size."),f})},a.fixedFadeInZoomOutCircumscribed=function(b,c,e,f){return a.fixedFadeInZoomOutCommon(b,c,e,f,function(a,b,c,e){var f=1;return 0!==c&&0!==e?f=c>=e?b/e:a/c:console.error(d+"invalid image size."),f})},a.fixedFadeInZoomOutCommon=function(b,c,d,e,f){var g=d&&d.scale?d.scale:1.25,h=d&&d.duration?d.duration:5e3,i=d&&d.focusDuration?d.focusDuration:0,j=d&&d.transformDuration?d.transformDuration:h,k=d&&d.fadeDuration?d.fadeDuration:2500,l=a.initViewport(b,c),m=null;e||(m={$element:$(l),fade:a.createFadeProperty(1,0),transform:a.createHardwareAcceleratorProperty(l)});var n=$(b).width(),o=$(b).height(),p=$(c).find("img").first().width(),q=$(c).find("img").first().height(),r=f(n,o,p,q),s={$element:$(c),fade:a.createFadeProperty(.3,1),transform:a.createTransformProperty(r*g,0,0,r,0,0)},t={viewport:b,oldTarget:m,newTarget:s,fadeDuration:k,transformDuration:j,focusDuration:i};return t},a.customEffect=function(b,e,f,g){var h=f&&f.oldEndScale?f.oldEndScale:null,i=f&&f.oldEndOffsetX?f.oldEndOffsetX:null,j=f&&f.oldEndOffsetY?f.oldEndOffsetY:null,k=(f&&f.oldEndOpacity?f.oldEndOpacity:null,f&&f.newStartScale?f.newStartScale:-1),l=f&&f.newStartOffsetY?f.newStartOffsetY:0,m=f&&f.newStartOffsetY?f.newStartOffsetY:0,n=f&&f.newEndOpacity?f.newEndOpacity:.3,o=f&&f.newEndScale?f.newEndScale:-1.25,p=f&&f.newEndOffsetX?f.newEndOffsetX:0,q=(f&&f.newEndOffsetY?f.newEndOffsetY:0,f&&f.newEndOpacity?f.newEndOpacity:1),r=1,s=f&&f.duration?f.duration:4e3,t=f&&f.focusDuration?f.focusDuration:0,u=f&&f.transformDuration?f.transformDuration:s,v=f&&f.transformTimingFunction?f.fadeTimingFunction:"ease-out",w=f&&f.fadeDuration?f.fadeDuration:Math.floor(u/2),x=f&&f.fadeTimingFunction?f.fadeTimingFunction:"linear";if(0>k||0>o){var y=$(b).width(),z=$(b).height(),A=$(e).find("img").first().width(),B=$(e).find("img").first().height();0!==A&&0!==B?r=y>=z?y/A:z/B:console.error(d+"invalid image size."),k=Math.abs(k),o=Math.abs(o)}var C=a.initViewport(b,e),D=null;if(!g){var E=parseInt($(C).css("opacity"),10),F=c.getCssMatrixValue($(C),"translateX"),G=c.getCssMatrixValue($(C),"translateY"),H=c.getCssMatrixValue($(C),"scaleX");null==h&&(h=H),null==i&&(i=F),null==j&&(j=G),D={$element:$(C),fade:a.createFadeProperty(E,h),transform:a.createTransformProperty(H,F,G,h,i,j)}}var I={$element:$(e),fade:a.createFadeProperty(n,q),transform:a.createTransformProperty(r*k,l,m,r*o,p,m)},J={viewport:b,oldTarget:D,newTarget:I,transformDuration:u,transformTimingFunction:v,fadeDuration:w,fadeTimingFunction:x,focusDuration:t};return J},a.startEffect=function(b){return c.isTransitionSupported?a.startEffectByCssTransition(b):a.startEffectByTimerAnimation(b)},a.initViewport=function(a,b){var d=$(a).children(":first");$(d).css(c.cssHideBackFace),$(b).css(c.cssHideBackFace),c.clearTransitions(d),c.clearTransitions(b);var e={position:"absolute",top:"0px",left:"0px",right:"0px",bottom:"0px",visibility:"hidden"};return $(b).css(e),$(a).append(b),d},a.createFadeProperty=function(a,b){var c={start:{opacity:a.toString(10)},end:{opacity:b.toString(10)}};return c},a.createTransformProperty=function(a,b,d,e,f,g){var h={},i={},j="",k="";j=c.buildCssTransformString(a,b,d),k=c.buildCssTransformString(e,f,g);var l=0;for(l=0;l<c.cssPrefixes.length;l++)h[c.cssPrefixes[l]+"transform"]=j,i[c.cssPrefixes[l]+"transform"]=k;var m={start:h,end:i};return m},a.createHardwareAcceleratorProperty=function(b){if(null==b)return a.createTransformProperty(1,0,0,1,0,0);var d=c.getCssMatrixValue($(b),"translateX"),e=c.getCssMatrixValue($(b),"translateY"),f=c.getCssMatrixValue($(b),"scaleX");return a.createTransformProperty(f,d,e,f,d,e)},a.startEffectByCssTransition=function(b){var e=$.Deferred(),f=0,g=0<b.fadeDuration,h=0<b.transformDuration;if(g&&f++,h&&f++,0===f)return console.error(d+"no transtion setting."),e.reject();a.setTransitionProperty(b.oldTarget,"start"),a.setTransitionProperty(b.newTarget,"start");var i=0,j=function(){i++,i>=f&&e.resolve()};return setTimeout(function(){a.setTransitionProperty(b.oldTarget,"end"),a.setTransitionProperty(b.newTarget,"end").on(c.transitionEnd,j);var d={},e=0;for(e=0;e<c.cssPrefixes.length;e++){var f=b.fadeDuration/1e3+"s",i=b.transformDuration/1e3+"s";if(d[c.cssPrefixes[e]+"transition"]="",g){var k="opacity "+f+(b.fadeTimingFunction?" "+b.fadeTimingFunction:" linear");d[c.cssPrefixes[e]+"transition"]+=k}if(h){""!==d[c.cssPrefixes[e]+"transition"]&&(d[c.cssPrefixes[e]+"transition"]+=",");var l=c.cssPrefixes[e]+"transform "+i+(b.transformTimingFunction?" "+b.transformTimingFunction:" linear");d[c.cssPrefixes[e]+"transition"]+=l}}b.oldTarget&&b.oldTarget.$element&&b.oldTarget.$element.css(d),b.newTarget&&b.newTarget.$element&&b.newTarget.$element.css(d).css("visibility","visible")},100),e.promise()},a.startEffectByTimerAnimation=function(c){var e=$.Deferred();a.setTransitionProperty(c.oldTarget,"start"),a.setTransitionProperty(c.newTarget,"start");var f=b.TimerAnimationInfo.start(c.oldTarget,c.fadeDuration,c.transformDuration),g=b.TimerAnimationInfo.start(c.newTarget,c.fadeDuration,c.transformDuration);return $.when(f,g).done(function(){e.resolve()}).fail(function(){console.error(d+"failed timer animation."),e.reject()}),e.promise()},a.setTransitionProperty=function(a,b){if(!a||!a.$element)return null;switch(b){case"start":a.fade&&a.fade.start&&a.$element.css(a.fade.start),a.transform&&a.transform.start&&a.$element.css(a.transform.start);break;case"end":a.fade&&a.fade.end&&a.$element.css(a.fade.end),a.transform&&a.transform.end&&a.$element.css(a.transform.end);break;default:return console.error(d+"no support point identifier. : "+b),null}return a.$element},a.s_imageOffset=50,a}();b.Transition=e}(b=a.SlideShow||(a.SlideShow={}))}(a||(a={}));var a;return function(a){var b;!function(b){function c(a){d.ENABLE_TOUCH_LOG&&console.log(h+a)}var d,e=a.Tools.CSS,f=a.Tools.touchEvent,g=a.Tools.Touch,h="[CDP.SlideShow.Player] ";!function(a){a.ENABLE_TOUCH_LOG=!1,a.EXEC_STEP_DELAY_TIME=100}(d||(d={}));var i=function(){function i(){this._settings=null,this._imgContainer=null,this._preloadImages=null,this._preloadCanceler=null,this._$viewport=null,this._transitionList=[],this._isPlaying=!1,this._isTransitioning=!1,this._isDragStarted=!1,this._isPinching=!1,this._errorCount=0,this._rightImage=null,this._leftImage=null,this._promise=null,this._resizeHandler=null}return i.prototype.init=function(b,c,d,e){var f=this,j=$.Deferred();return this._settings=$.extend({},i._defaultOptions,e),this._imgContainer=new a.Tools.InfinityContainer,this._trIndx=0,this._errorCount=0,this._snapDuration=200,this._isPlaying=!1,this._isTransitioning=!1,this._isDragStarted=!1,this._rightImage=null,this._leftImage=null,this._isPinching=!1,this._currentTranslateX=0,this._currentTranslateY=0,this._currentScale=1,this._transitionList=c,this._$viewport=d,this._preloadImages={},this._preloadCanceler={},this._resizeHandler=_.bind(this.resizeImages,this),$(window).on("resize",this._resizeHandler),this._imgContainer.init(b,e).then(function(){return f._settings.enableTouch&&g.setTarget(f._$viewport),f.subscribeToEvents(),f.initPreloadedImages()}).then(function(){return f._settings.showFirstImageImmediately?f.showCurrentImage():void 0}).then(function(){j.resolve()}).fail(function(){console.error(h+"Player.init(), failed."),j.resolve()}),this.managePromise(j)},i.prototype.terminate=function(){this._isPlaying&&this.notifyStateChanged("state:play-state-changed",this._isPlaying),g.removeTarget(this._$viewport),this._$viewport.off(),this.cleanViewPort(this._$viewport),this._$viewport.children().remove();for(var a in this._preloadImages)"outerleft"!==a&&"outerright"!==a&&this.deletePreloadedImage(a);$(window).off("resize",this._resizeHandler),this._isPlaying=!1,this._isTransitioning=!1,this._isDragStarted=!1,this._rightImage=null,this._leftImage=null,this._isPinching=!1,this._preloadImages={},this._preloadCanceler={},this._imgContainer=null,this._transitionList=[],this._$viewport=null},i.prototype.valid=function(){return this._imgContainer?this._imgContainer.valid():!1},i.prototype.isLoading=function(){return this.valid()?this._imgContainer.isInAsyncProc():!1},i.prototype.waitLoadComplete=function(){return this.valid()?this._imgContainer.waitAsyncProc():$.Deferred().resolve()},i.prototype.getViewport=function(){return this._$viewport},i.prototype.getCurrentImageIndex=function(){return this.valid()?this._imgContainer.getIndex():0},i.prototype.setCurrentImageIndex=function(a){var b=this;if(!this.valid())return $.Deferred().reject();var c=$.Deferred();return this._isPlaying=!1,this.notifyStateChanged("state:play-state-changed",this._isPlaying),this.cleanViewPort(this._$viewport),this._imgContainer.seek(a).promise.then(function(){return b.cleanViewPort(b._$viewport),b.initPreloadedImages()}).then(function(){return b.showCurrentImage()}).then(function(){b.notifyStateChanged("state:playback-image-changed",b._imgContainer.getIndex()),c.resolve()}).fail(function(){console.error(h+"setCurrentImageIndex() failed."),c.reject()}),this.managePromise(c)},i.prototype.getCurrentImageData=function(){if(!this.valid())return 0;var a=this._imgContainer.getCurrentCursorArray();return a.getData()},i.prototype.removeCurrentImage=function(){var a=this,b=$.Deferred();return this.valid()?this._isPlaying?(console.error(h+"cannot call removeCurrentImage() when playing."),b.reject()):this._imgContainer.remove()?(this._imgContainer.size()<=0?b.resolve():this._imgContainer.waitAsyncProc().then(function(){return a.cleanViewPort(a._$viewport),a.initPreloadedImages()}).then(function(){return a.showCurrentImage()}).then(function(){a.notifyStateChanged("state:playback-image-changed",a._imgContainer.getIndex()),b.resolve()}).fail(function(){console.error(h+"removeCurrentImage() failed."),b.reject()}),this.managePromise(b)):(console.error(h+"this._imgContainer.remove() failed."),b.reject()):b.reject()},i.prototype.getImageDataCount=function(){return this.valid()?this._imgContainer.size():0},i.prototype.getImageDataContainer=function(){return this.valid()?this._imgContainer:null},i.prototype.isPlaying=function(){return this._isPlaying},i.prototype.stepUp=function(a,c,f){var g=this;this.waitAsyncProc().always(function(){g._isPlaying&&g.pause();var i="number"==typeof f?f:g._snapDuration,j=a||$(g._$viewport).children(":first");g.setSideImages(b.Transition.imageOffset),setTimeout(function(){e.moveImage(0,0,1,1,g._rightImage,i,function(){e.clearTransformsTransitions(j),e.clearTransformsTransitions(g._leftImage),$(j).remove(),$(g._leftImage).remove(),g._leftImage=null,g._rightImage=null,g.moveNext().then(function(){"function"==typeof c&&c(),g.notifyStateChanged("state:playback-image-changed",g._imgContainer.getIndex())},function(){console.error(h+"moveNext() failed in stepUp()")})});var a=-1*($(g._$viewport).width()+b.Transition.imageOffset);e.moveImage(a,0,1,1,j,i)},g._isTransitioning?0:d.EXEC_STEP_DELAY_TIME)})},i.prototype.stepDown=function(a,c,f){var g=this;this.waitAsyncProc().always(function(){g._isPlaying&&g.pause();var i="number"==typeof f?f:g._snapDuration,j=a||$(g._$viewport).children(":first");g.setSideImages(b.Transition.imageOffset),setTimeout(function(){e.moveImage(0,0,1,1,g._leftImage,i,function(){e.clearTransformsTransitions(j),e.clearTransformsTransitions(g._rightImage),$(j).remove(),$(g._rightImage).remove(),g._leftImage=null,g._rightImage=null,g.movePrevious().then(function(){"function"==typeof c&&c(),g.notifyStateChanged("state:playback-image-changed",g._imgContainer.getIndex())},function(){console.error(h+"movePrevious() failed in stepDown()")})});var a=$(g._$viewport).width()+b.Transition.imageOffset;e.moveImage(a,0,1,1,j,i)},g._isTransitioning?0:d.EXEC_STEP_DELAY_TIME)})},i.prototype.play=function(){var a=this;this.waitAsyncProc().always(function(){if(!a._isPlaying){a._isPlaying=!0,a.notifyStateChanged("state:play-state-changed",a._isPlaying);var c=function(d,e,f){if(a._isPlaying){a.notifyStateChanged("state:playback-image-changed",a._imgContainer.getIndex()),f&&a.cleanViewPort(d);var g=null;switch(a._transitionList[a._trIndx].type){case"slidein":g=b.Transition.slideIn(d,e,a._transitionList[a._trIndx].config,f);break;case"fadein":g=b.Transition.fadeIn(d,e,a._transitionList[a._trIndx].config,f);break;case"kenburn":g=b.Transition.kenBurn(d,e,a._transitionList[a._trIndx].config,f);break;case"fixed-fadein-zoomout-inscribed":g=b.Transition.fixedFadeInZoomOutInscribed(d,e,a._transitionList[a._trIndx].config,f);break;case"fixed-fadein-zoomout-circumscribed":g=b.Transition.fixedFadeInZoomOutCircumscribed(d,e,a._transitionList[a._trIndx].config,f);break;case"custom-effect":g=b.Transition.customEffect(d,e,a._transitionList[a._trIndx].config,f);break;default:console.warn(h+"unknown transition type: "+a._transitionList[a._trIndx].type),g=b.Transition.fadeIn(d,e,a._transitionList[a._trIndx].config,f)}a.transition(g,function(){if(a._isPlaying){if(a._imgContainer.isLast())return console.log(h+"reached last content."),void a.pause();a.moveNextTransition(),a.moveNext().then(function(){a.waitForCurrentImageReady().always(function(){c(d,$(a._preloadImages[a._imgContainer.getIndex()]).clone()[0])})},function(){console.error(h+"moveNext() failed in transitionCall() callback.")})}})}};a.waitForCurrentImageReady().always(function(){c(a._$viewport,$(a._preloadImages[a._imgContainer.getIndex()]).clone()[0],!0)})}})},i.prototype.stop=function(){var a=this,b=$.Deferred();return this._isPlaying?(this._isPlaying=!1,this.notifyStateChanged("state:play-state-changed",this._isPlaying),this._trIndx=0,this._imgContainer.first().promise.then(function(){return a.cleanViewPort(a._$viewport),a.initPreloadedImages()}).then(function(){return a.showCurrentImage()}).then(function(){a.notifyStateChanged("state:playback-image-changed",a._imgContainer.getIndex()),b.resolve()}).fail(function(){console.error(h+"stop() failed."),b.reject()}),this.managePromise(b)):b.resolve()},i.prototype.pause=function(){if(this._isPlaying){this._isPlaying=!1,this.notifyStateChanged("state:play-state-changed",this._isPlaying),this.cleanViewPort(this._$viewport);var a=$(this._$viewport).children(":first");a&&e.clearTransformsTransitions(a)}},i.prototype.restart=function(){var a=this;this.stop().then(function(){a.play()},function(){console.error(h+"stop() failed.")})},i.prototype.enableTouchEvent=function(a){this._settings.enableTouch=a,a?g.setTarget(this._$viewport):g.removeTarget(this._$viewport)},i.prototype.isInAsyncProc=function(){return this._promise&&"pending"===this._promise.state()?!0:!1},i.prototype.waitAsyncProc=function(){var a=this,b=$.Deferred(),c=function(){a.isInAsyncProc()?a._promise.always(function(){setTimeout(c)}):b.resolve()};return setTimeout(c),b.promise()},i.prototype.managePromise=function(a){var b=this,c=function(){b._promise=a,b._promise.always(function(){b._promise=null})};return this.isInAsyncProc()?this.waitAsyncProc().always(function(){c()}):c(),a.promise()},i.prototype.notifyStateChanged=function(a,b){"function"==typeof this._settings.stateChangedCallback&&this._settings.stateChangedCallback(a,b)},i.prototype.initPreloadedImages=function(){var a=this,b=$.Deferred(),c=$.Deferred(),d=$.Deferred(),e=0,f=0,g=this._imgContainer.getIndex(),i=g,j=g,k=function(){if(a._settings.preloadCount<=f)a._imgContainer.waitAsyncProc().then(function(){c.resolve()},function(){console.error(h+"preload right side, wait async proc failed."),c.reject()});else{f++,i++,a._imgContainer.size()<=i&&(i=0);var b=a._imgContainer.seek(i);b.succeeded||(console.error(h+"preload right side failed."),c.reject()),b.promise.then(function(){return a.prepareImageDiv(i)}).then(function(b){a._preloadImages[i]=b,a._preloadImages.outerright=i,setTimeout(k,0)}).fail(function(){console.error(h+"preload right side failed."),c.reject()})}return c.promise()},l=function(){if(a._settings.preloadCount<=e)a._imgContainer.waitAsyncProc().then(function(){d.resolve()},function(){console.error(h+"preload left side, wait async proc failed."),d.reject()});else{e++,j--,0>j&&(j=a._imgContainer.size()-1);var b=a._imgContainer.seek(j);b.succeeded||(console.error(h+"preload left side failed."),d.reject()),b.promise.then(function(){return a.prepareImageDiv(j)}).then(function(b){a._preloadImages[j]=b,a._preloadImages.outerleft=j,setTimeout(l,0)}).fail(function(){console.error(h+"preload left side failed."),d.reject()})}return d.promise()};for(var m in this._preloadImages)"outerleft"!==m&&"outerright"!==m&&this.deletePreloadedImage(m);return this._preloadImages={},this.prepareImageDiv(g).then(function(b){a._preloadImages[g]=b}).then(function(){return k()}).then(function(){return l()}).then(function(){return a._imgContainer.seek(g).promise}).then(function(){b.resolve()}).fail(function(){console.error(h+"failed preload images."),b.reject()}),b.promise()},i.prototype.deletePreloadedImage=function(a){if(this._preloadImages[a]&&($(this._preloadImages[a]).remove(),delete this._preloadImages[a]),this._preloadCanceler[a]){var b=this._preloadCanceler[a];b.abort(),delete this._preloadCanceler[a]}},i.prototype.showCurrentImage=function(){var a=$.Deferred(),c=b.Transition.fadeIn(this._$viewport,this._preloadImages[this._imgContainer.getIndex()],{duration:50,focusDuration:50},!0);return this.transition(c,function(){a.resolve()}),a.promise()},i.prototype.cleanViewPort=function(a){this._rightImage&&(e.clearTransformsTransitions(this._rightImage),$(this._rightImage).css({opacity:"",position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"}).remove(),this._rightImage=null),this._leftImage&&(e.clearTransformsTransitions(this._leftImage),$(this._leftImage).css({opacity:"",position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"}).remove(),this._leftImage=null),$(a).children().css({opacity:"",position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"});var b=$(a).children();if(!(b.length<2))for(var c=0;c<b.length-1;c++)$(b[c]).remove()},i.prototype.reposition=function(a,b){var c=this,d=e.getCssMatrixValue(a,"translateY"),f=e.getCssMatrixValue(a,"translateX"),g="number"==typeof this._currentScale?this._currentScale:1,h=($(a).find("img").width()*g-$(this._$viewport).width())/2,i=($(a).find("img").height()*g-$(this._$viewport).height())/2,j=d>0?i:-1*i,k=h>0?h:0,l=0,m=0;switch(k=0>f?-1*k:k,b){case"x":l=k,m=d;break;case"y":l=f,m=$(a).find("img").height()*g>$(this._$viewport).height()?j:0;break;case"xy":l=k,m=$(a).find("img").height()*g>$(this._$viewport).height()?j:0}e.moveImage(l,m,g,g,a,this._snapDuration,function(){c.cleanViewPort(c._$viewport),c._isTransitioning=!1})},i.prototype.resizeImages=function(){var a=this,b=function(b){var c=$(b).find("img").first();c.attr(i.DATA_IMG_LOAD_SUCCEEDED)&&a.centerImage(c[0],a._$viewport)},c=this._$viewport.children(":first");b(c);for(var d in this._preloadImages)"outerleft"!==d&&"outerright"!==d&&b(this._preloadImages[d])},i.prototype.centerImage=function(a,b){var c=$(b).height(),d=$(b).width(),e=a.height,f=a.width,g=a.height,h=a.width,i=1;c>g&&d>h&&(h=Math.floor(c/g*h),g=c),g>c&&(i=(e-c)/e,g=c,h=Math.floor(f-f*i)),h>d&&(i=(f-d)/f,g=Math.floor(e-e*i),h=d),$(a).css({top:"",left:"",bottom:"",right:"","margin-left":"","margin-top":""});var j=g===c,k=j?"top":"left",l=j?"bottom":"right",m=j?"left":"top",n=j?"margin-left":"margin-top",o=j?"-"+h/2+"px":"-"+g/2+"px",p={position:"absolute",height:g+"px",width:h+"px"};p[k]="0px",p[l]="0px",p[m]="50%",p[n]=o,$(a).css(p)},i.prototype.setSpinner=function(a,b){var c=document.createElement("div"),d=document.createElement("p");$(d).text("Loading...");var e={"font-size":"large",color:"gray",position:"absolute",left:"50%",top:"50%",padding:"0px","margin-left":"-40px","margin-top":"-20px"};$(d).css(e);var f={width:$(a).width(),height:$(a).height()};$(c).css(f),$(c).append(d),$(b).append(c)},i.prototype.prepareImageDiv=function(a){var b,c=this,d=$.Deferred();return this._imgContainer&&this._imgContainer.valid()?(this._imgContainer.hasAsyncAccesser()?(b=document.createElement("div"),$(b).css("background-color","black"),"function"==typeof this._settings.setSpinnerCallback?this._settings.setSpinnerCallback(this._$viewport,b):this.setSpinner(this._$viewport,b),d.resolve(b),setTimeout(function(){var d=c._imgContainer.get(a);c._preloadCanceler[a]=d,d.then(function(d){c._preloadImages[a]&&c.getImageDiv(c._$viewport,d,b),b=null}).fail(function(){console.error(h+"_imgContainer.get(), failed."),c._errorCount++,b=null})},0)):d.resolve(this.getImageDiv(this._$viewport,this._imgContainer.get(a))),d.promise()):(console.error(h+"_imgContainer, not ready."),d.reject())},i.prototype.getImageDiv=function(a,b,c){var d=this;return null==b&&(console.error(h+"imgUrl is null."),b="pmo.slideshow.unreached"),c||(c=document.createElement("div"),$(c).css("background-color","black"),"function"==typeof this._settings.setSpinnerCallback?this._settings.setSpinnerCallback(a,c):this.setSpinner(a,c)),function(c){var e=new Image,f=d;$(e).on("load",function(){f.centerImage(this,a);var b=$(this);b.parent().children("div").remove(),b.css("display","inline").attr(i.DATA_IMG_LOAD_SUCCEEDED,"true")}).on("error",function(){console.error(h+"image load failed.");var a=this;$(a).attr(i.DATA_IMG_LOAD_FAILED,"true"),f._errorCount++}).css("display","none"),$(c).append(e),e.src=b,e.complete&&(console.log(h+"image ready. [img.complete === true]"),$(e).load()),e=null}(c),c},i.prototype.waitForCurrentImageReady=function(){var a=this,b=$.Deferred(),c=function(){setTimeout(function(){var d=a._preloadImages[a._imgContainer.getIndex()];if($(d).find("img").first().attr(i.DATA_IMG_LOAD_SUCCEEDED))return void b.resolve();if($(d).find("img").first().attr(i.DATA_IMG_LOAD_FAILED)){if(a._settings.allowedErrorMax<a._errorCount)return console.log(h+"reached error maximum count."),a.stop().always(function(){a._errorCount=0,a.notifyStateChanged("error:max-error-count")}),void b.reject();a.moveNext().always(function(){c()})}else c()},100)};return c(),b.promise()},i.prototype.moveIndecesForward=function(){this._trIndx++,this._trIndx===this._transitionList.length&&(this._trIndx=0),this._imgContainer.next()},i.prototype.moveNextTransition=function(){this._trIndx++,this._trIndx===this._transitionList.length&&(this._trIndx=0)},i.prototype.moveNext=function(){var a=this,b=$.Deferred(),c=this._imgContainer.next();return c.succeeded?(c.promise.then(function(){return a.movePreloadToRight()}).then(function(){b.resolve()}).fail(function(){console.error(h+"movePrevious(), failed."),b.reject()}),b.promise()):(console.error(h+"_imgContainer.next(), failed."),b.reject())},i.prototype.movePreloadToRight=function(){var a=this,b=$.Deferred(),c=this._preloadImages.outerright+1;return this._imgContainer.size()<=c&&(c=0),this._preloadImages[c]?b.resolve():this.prepareImageDiv(c).then(function(d){a._preloadImages[c]=d,a._preloadImages.outerright=c;var e=a._preloadImages.outerleft,f=e+1;a._imgContainer.size()<=f&&(f=0),a.deletePreloadedImage(e),a._preloadImages.outerleft=f,b.resolve()},function(){console.error(h+"prepareImageDiv(), failed."),b.reject()}),b.promise()},i.prototype.movePrevious=function(){var a=this,b=$.Deferred(),c=this._imgContainer.previous();return c.succeeded?(c.promise.then(function(){return a.movePreloadToLeft()}).then(function(){b.resolve()}).fail(function(){console.error(h+"movePrevious(), failed."),b.reject()}),b.promise()):(console.error(h+"_imgContainer.previous(), failed."),b.reject())},i.prototype.movePreloadToLeft=function(){var a=this,b=$.Deferred(),c=this._preloadImages.outerleft-1;return 0>c&&(c=this._imgContainer.size()-1),this._preloadImages[c]?b.resolve():this.prepareImageDiv(c).then(function(d){a._preloadImages[c]=d,a._preloadImages.outerleft=c;var e=a._preloadImages.outerright,f=e-1;0>f&&(f=a._imgContainer.size()-1),a.deletePreloadedImage(e),a._preloadImages.outerright=f,b.resolve()},function(){console.error(h+"prepareImageDiv(), failed."),b.reject()}),b.promise()},i.prototype.getNext=function(){var a=this._imgContainer.getIndex()+1;if(this._imgContainer.size()<=a){if(!this._imgContainer.isRepeatable())return null;a=0}var b=this._preloadImages[a];return e.clearTransformsTransitions(b),$(b).css({position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"}),b},i.prototype.getPrevious=function(){var a=this._imgContainer.getIndex()-1;if(0>a){if(!this._imgContainer.isRepeatable())return null;a=this._imgContainer.size()-1}var b=this._preloadImages[a];return e.clearTransformsTransitions(b),$(b).css({position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"}),b},i.prototype.setSideImages=function(a){if(!this._rightImage){var b=$(this._$viewport).width()+a;this._rightImage=this.getNext(),e.moveImage(b,0,1,1,this._rightImage,0),$(this._$viewport).append(this._rightImage)}if(!this._leftImage){var c=-1*($(this._$viewport).width()+a);this._leftImage=this.getPrevious(),e.moveImage(c,0,1,1,this._leftImage,0),$(this._$viewport).append(this._leftImage)}},i.prototype.transition=function(a,c){var d=this;b.Transition.startEffect(a).always(function(){d.cleanViewPort(a.viewport),a.newTarget.$element.off(e.transitionEnd),setTimeout(function(){c()},a.focusDuration)})},i.prototype.subscribeToEvents=function(){var a=this;this._$viewport.on(f("doubletap"),function(){if(a._settings.enableTouch&&!a._isPlaying&&!a._isPinching&&!a._isTransitioning){c("Touch handled: [doubletap]");var b=$(a._$viewport).children(":first"),d=e.getCssMatrixValue(b,"scaleX");if(1!==d)a._isTransitioning=!0,e.moveImage(0,0,1,1,b,a._snapDuration,function(){a._currentScale=1,a._isTransitioning=!1});else{var f=e.getCssMatrixValue(b,"translateX"),g=e.getCssMatrixValue(b,"translateY"),h=3;a._isTransitioning=!0,e.moveImage(f,g,h,h,b,a._snapDuration,function(){a._currentScale=e.getCssMatrixValue(b,"scaleX"),a._isTransitioning=!1})}}}),this._$viewport.on(f("pinchstart"),function(){if(a._settings.enableTouch&&!a._isPlaying){c("Touch handled: [pinchstart]"),a._isPinching=!0;var b=$(a._$viewport).children(":first");

a._currentScale=e.getCssMatrixValue(b,"scaleX")}}),this._$viewport.on(f("pinchout"),function(b,d){a._isDragStarted=!1;var f=d/100,g=a._currentScale+f;if(a._settings.enableTouch&&!a._isTransitioning&&a._isPinching){c("Touch handled: [pinchout]"),a._isPlaying&&a.pause(),a.cleanViewPort(a._$viewport);var h=$(a._$viewport).children(":first"),i=e.getCssMatrixValue(h,"translateX"),j=e.getCssMatrixValue(h,"translateY");e.moveImage(i,j,g,g,h,0)}}),this._$viewport.on(f("pinchin"),function(b,d){a._isDragStarted=!1;var f=.7,g=d/100,h=a._currentScale-g;if(a._settings.enableTouch&&!a._isTransitioning&&a._isPinching&&!(f>h)){c("Touch handled: [pinchin]"),a._isPlaying&&a.pause(),a.cleanViewPort(a._$viewport);var i=$(a._$viewport).children(":first"),j=e.getCssMatrixValue(i,"translateX"),k=e.getCssMatrixValue(i,"translateY");e.moveImage(j,k,h,h,i,0)}}),this._$viewport.on(f("pinchend"),function(){if(a._settings.enableTouch&&!a._isPlaying){c("Touch handled: [pinchend]");var b=$(a._$viewport).children(":first");a._currentScale=e.getCssMatrixValue(b,"scaleX"),a._isPinching=!1}}),this._$viewport.on(f("dragstart"),function(){if(a._settings.enableTouch&&!a._isTransitioning&&!a._isDragStarted&&!a._isPinching&&!a._isPlaying){c("Touch handled: [dragstart]");var d=$(a._$viewport).children(":first");a._currentTranslateX=e.getCssMatrixValue(d,"translateX"),a._currentTranslateY=e.getCssMatrixValue(d,"translateY"),a.cleanViewPort(a._$viewport),a.setSideImages(b.Transition.imageOffset),a._isDragStarted=!0}}),this._$viewport.on(f("drag"),function(d,f,g,h,i){if(a._settings.enableTouch&&!a._isTransitioning&&a._isDragStarted&&!a._isPinching){c("Touch handled: [drag]");var j=$(a._$viewport).children(":first"),k="number"==typeof a._currentScale?a._currentScale:1,l=h+a._currentTranslateX,m=1!==k?i:0;m+=a._currentTranslateY,e.moveImage(l,m,k,k,j,0);var n=($(j).find("img").width()*k-$(a._$viewport).width())/2,o=Math.abs(e.getCssMatrixValue(j,"translateX"));if(o>=n){var p=n>0?n:0,q=$(a._$viewport).width()+h+b.Transition.imageOffset+a._currentTranslateX+p,r=-1*($(a._$viewport).width()+b.Transition.imageOffset+p)+h+a._currentTranslateX;e.moveImage(q,0,1,1,a._rightImage,0),e.moveImage(r,0,1,1,a._leftImage,0)}}}),this._$viewport.on(f("swipe"),function(d,f){if(a._settings.enableTouch&&!a._isTransitioning&&!a._isPinching){c("Touch handled: [swipe]"),a._isTransitioning=!0,a._isPlaying&&a.pause();var g=$(a._$viewport).children(":first"),h=$(a._$viewport).width()/3,i="swipeleft"===f?a._rightImage:a._leftImage,j=e.isTransitionSupported?e.getCssMatrixValue(i,"translateX"):parseInt($(i).css("left"),10),k=$(a._$viewport).width()-Math.abs(j),l="number"==typeof a._currentScale?a._currentScale:1,m=($(g).find("img").height()*l-$(a._$viewport).height())/2,n=e.getCssMatrixValue(g,"translateY");i&&(k>h&&1!==l||1===l)?"swipeleft"===f?a.stepUp(g,function(){a._isTransitioning=!1,a._currentScale=1}):"swiperight"===f?a.stepDown(g,function(){a._isTransitioning=!1,a._currentScale=1}):a._isTransitioning=!1:Math.abs(k)!==b.Transition.imageOffset&&1===l?Math.abs(n)>=m?a.reposition(g,"xy"):a.reposition(g,"x"):a._isTransitioning=!1}}),this._$viewport.on(f("dragend"),function(b,d,f,g){if(a._settings.enableTouch&&a._isDragStarted&&!a._isPinching){c("Touch handled: [dragend]"),0===g&&0===a._currentTranslateX&&a.cleanViewPort(a._$viewport),a._isDragStarted=!1;var h=$(a._$viewport).children(":first");a._currentTranslateX=e.getCssMatrixValue(h,"translateX"),a._currentTranslateY=e.getCssMatrixValue(h,"translateY")}})},i.DATA_IMG_LOAD_SUCCEEDED="data-image-load-succeeded",i.DATA_IMG_LOAD_FAILED="data-image-load-faild",i._defaultOptions={preloadCount:4,enableTouch:!0,showFirstImageImmediately:!0,setSpinnerCallback:null,stateChangedCallback:function(){},propAccesser:null,globalContainerMax:null,localContainerMax:null,setupContainer:null,repeat:!1,firstContainerStart:0,firstContainerEnd:null,firstContainerPosition:0,allowedErrorMax:100},i}();b.Player=i}(b=a.SlideShow||(a.SlideShow={}))}(a||(a={})),a.SlideShow});
//# sourceMappingURL=cdp.slideshow-0.3.0.min.map