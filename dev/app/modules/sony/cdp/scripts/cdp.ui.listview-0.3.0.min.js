/* CDP-Template 2015-03-31 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","backbone"],function(){return b(a.CDP||(a.CDP={}))}):b(a.CDP||(a.CDP={}))}(this,function(a){a.UI=a.UI||{};var a;!function(a){var b;!function(a){var b;!function(a){a.WRAPPER_CLASS="listview-wrapper",a.WRAPPER_SELECTOR="."+a.WRAPPER_CLASS,a.SCROLL_MAP_CLASS="listview-scroll-map",a.SCROLL_MAP_SELECTOR="."+a.SCROLL_MAP_CLASS,a.INACTIVE_CLASS="inactive",a.INACTIVE_CLASS_SELECTOR="."+a.INACTIVE_CLASS,a.RECYCLE_CLASS="listview-recycle",a.RECYCLE_CLASS_SELECTOR="."+a.RECYCLE_CLASS,a.LISTITEM_BASE_CLASS="listview-item-base",a.LISTITEM_BASE_CLASS_SELECTOR="."+a.LISTITEM_BASE_CLASS,a.DATA_PAGE_INDEX="data-page-index",a.DATA_CONTAINER_INDEX="data-container-index"}(b=a.ListViewGlobalConfig||(a.ListViewGlobalConfig={}))}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b;!function(a){a.cssPrefixes=["-webkit-","-moz-","-ms-","-o-",""],a.getCssMatrixValue=function(b,c){for(var d=0,e=0,f=0,g=0,h=0;h<a.cssPrefixes.length;h++){var i=$(b).css(a.cssPrefixes[h]+"transform");if(i){var j=-1!==i.indexOf("3d")?!0:!1;i=i.replace("matrix3d","").replace("matrix","").replace(/[^\d.,-]/g,"");var k=i.split(",");d=Number(k[j?12:4]),e=Number(k[j?13:5]),f=Number(k[0]),g=Number(k[j?5:3]);break}}switch(c){case"translateX":return isNaN(d)?0:d;case"translateY":return isNaN(e)?0:e;case"scaleX":return isNaN(f)?1:f;case"scaleY":return isNaN(g)?1:g;default:return 0}},a.transitionEnd="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",a.setTransformsTransitions=function(b,c,d,e){for(var f=$(b),g={},h=d/1e3+"s",i=" "+h+" "+e,j=", transform"+i,k=0;k<a.cssPrefixes.length;k++)g[a.cssPrefixes[k]+"transition"]=c+i+j;f.css(g)},a.clearTransitions=function(b){var c=$(b);c.off(a.transitionEnd);for(var d={},e=0;e<a.cssPrefixes.length;e++)d[a.cssPrefixes[e]+"transition"]="";c.css(d)},a.abs=function(a){return a>=0?a:-a},a.max=function(a,b){return a>=b?a:b}}(b=a._ListViewUtils||(a._ListViewUtils={}))}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(b){var c=a.UI.ListViewGlobalConfig,d=a.UI._ListViewUtils,e="[CDP.UI.LineProfile] ",f=function(){function a(a,b,c,d){this._owner=a,this._height=b,this._initializer=c,this._info=d,this._index=null,this._pageIndex=null,this._offset=null,this._$base=null,this._instance=null}return a.prototype.activate=function(){if(null==this._instance){var a;this._$base=this.prepareBaseElement(),a=$.extend({},{$el:this._$base,owner:this._owner,lineProfile:this},this._info),this._instance=new this._initializer(a),this._$base.show()}this.updatePageIndex(this._$base),"visible"!==this._$base.css("visibility")&&this._$base.css("visibility","visible")},a.prototype.hide=function(){null==this._instance&&this.activate(),"hidden"!==this._$base.css("visibility")&&this._$base.css("visibility","hidden")},a.prototype.inactivate=function(){null!=this._instance&&("visible"!==this._$base.css("visibility")&&this._$base.css("visibility","visible"),this._instance.remove(),this._instance=null,this._$base.addClass(c.RECYCLE_CLASS),this._$base.hide(),this._$base=null)},a.prototype.refresh=function(){null!=this._instance&&this._instance.render()},a.prototype.isActive=function(){return null!=this._instance},a.prototype.updateHeight=function(a,b){var c=a-this._height;this._height=a,this._owner.updateScrollMapHeight(c),null!=b&&b.reflectAll&&this._owner.updateProfiles(this._index)},a.prototype.resetDepth=function(){null!=this._instance&&this._$base.css("z-index",this._owner.getListViewOptions().baseDepth)},Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"index",{get:function(){return this._index},set:function(a){this._index=a,null!=this._$base&&this.updateIndex(this._$base)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pageIndex",{get:function(){return this._pageIndex},set:function(a){this._pageIndex=a,null!=this._$base&&this.updatePageIndex(this._$base)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"offset",{get:function(){return this._offset},set:function(a){this._offset=a,null!=this._$base&&this.updateOffset(this._$base)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),a.prototype.prepareBaseElement=function(){var a,b=this._owner.getScrollMapElement(),d=this._owner.findRecycleElements().first();return null!=this._$base?(console.warn(e+"this._$base is not null."),this._$base):(0<d.length?(a=d,a.removeAttr("z-index"),a.removeClass(c.RECYCLE_CLASS)):(a=$("<div class='"+c.LISTITEM_BASE_CLASS+"'></div>"),a.hide(),b.append(a)),a.height()!==this._height&&a.height(this._height),this.updateIndex(a),this.updateOffset(a),a)},a.prototype.updateIndex=function(a){a.attr(c.DATA_CONTAINER_INDEX)!==this._index.toString()&&a.attr(c.DATA_CONTAINER_INDEX,this._index.toString())},a.prototype.updatePageIndex=function(a){a.attr(c.DATA_PAGE_INDEX)!==this._pageIndex.toString()&&a.attr(c.DATA_PAGE_INDEX,this._pageIndex.toString())},a.prototype.updateOffset=function(a){var b={};if(this._owner.getListViewOptions().enableTransformOffset){if(d.getCssMatrixValue(a,"translateY")!==this._offset){for(var c=0;c<d.cssPrefixes.length;c++)b[d.cssPrefixes[c]+"transform"]="translate3d(0px,"+this._offset+"px,0px)";a.css(b)}}else parseInt(a.css("top"),10)!==this._offset&&a.css("top",this._offset+"px")},a}();b.LineProfile=f}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b="[CDP.UI.GroupProfile] ",c=function(){function c(a,b){this._id=a,this._owner=b,this._parent=null,this._children=[],this._expanded=!1,this._status="unregistered",this._mapLines={}}return c.prototype.addItem=function(b,d,e,f){var g,h=$.extend({},{groupProfile:this},e);return null==f&&(f=c.LAYOUT_KEY_DEFAULT),null==this._mapLines[f]&&(this._mapLines[f]=[]),g=new a.LineProfile(this._owner,Math.floor(b),d,h),"registered"!==this._status||null!=this._owner.layoutKey&&f!==this._owner.layoutKey||(this._owner._addLine(g,this.getLastLineIndex()+1),this._owner.update()),this._mapLines[f].push(g),this},c.prototype.addChildren=function(a){var b=this,c=a instanceof Array?a:[a];return c.forEach(function(a){a.setParent(b)}),this._children=this._children.concat(c),this},c.prototype.getParent=function(){return this._parent},c.prototype.getChildren=function(){return this._children},c.prototype.hasChildren=function(a){return this._children.length<=0?!1:null!=a?this._children[0].hasLayoutKeyOf(a):!0},c.prototype.hasLayoutKeyOf=function(a){return null==a&&(a=c.LAYOUT_KEY_DEFAULT),null!=this._mapLines[a]},c.prototype.expand=function(){var a=this,c=[];this._lines.length<0?console.warn(b+"this group has no lines."):this.hasChildren()?this.isExpanded()||(c=this.queryOperationTarget("registered"),this._expanded=!0,0<c.length&&this._owner.statusScope("expanding",function(){a._lines.forEach(function(a){a.refresh()}),a._owner._addLine(c,a.getLastLineIndex()+1),a._owner.update()})):console.warn(b+"this group has no children.")},c.prototype.collapse=function(a){var c=this,d=[];this.hasChildren()?this.isExpanded()&&(d=this.queryOperationTarget("unregistered"),this._expanded=!1,0<d.length&&(a=null!=a?a:this._owner.getListViewOptions().animationDuration,this._owner.statusScope("collapsing",function(){c._lines.forEach(function(a){a.refresh()}),c._owner.removeItem(d[0].index,d.length,a),c._owner.update()}))):console.warn(b+"this group has no children.")},c.prototype.ensureVisible=function(a){0<this._lines.length?this._owner.ensureVisible(this._lines[0].index,a):null!=a.callback&&a.callback()},c.prototype.toggle=function(a){this._expanded?this.collapse(a):this.expand()},c.prototype.isExpanded=function(){return this._expanded},c.prototype.register=function(a){return this._parent?console.error(b+"logic error: 'register' method is acceptable only top group."):this._owner._addLine(this.preprocess("registered"),a),this},c.prototype.restore=function(){var a=[];return this._parent?console.error(b+"logic error: 'restore' method is acceptable only top group."):this._lines&&(a=this._expanded?this._lines.concat(this.queryOperationTarget("active")):this._lines,this._owner._addLine(a)),this},c.prototype.getLastLineIndex=function(a){var c=this;void 0===a&&(a=!1);var d=function(){var b;return a&&(b=c.queryOperationTarget("active")),(null==b||b.length<=0)&&(b=c._lines),b}();return d.length<=0?(console.error(b+"logic error: this group is stil not registered."),null):d[d.length-1].index},Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),c.prototype.setParent=function(a){this._parent=a},c.prototype.preprocess=function(a){var b=[];return a!==this._status&&null!=this._lines&&(b=this._lines),this._status=a,b},c.prototype.queryOperationTarget=function(a){var c=function(d){var e=[];return d._children.forEach(function(d){switch(a){case"registered":e=e.concat(d.preprocess(a));break;case"unregistered":e=e.concat(d.preprocess(a));break;case"active":null!=d._lines&&(e=e.concat(d._lines));break;default:return void console.warn(b+"unknown operation: "+a)}d.isExpanded()&&(e=e.concat(c(d)))}),e};return c(this)},Object.defineProperty(c.prototype,"_lines",{get:function(){var a=this._owner.layoutKey;return null!=a?this._mapLines[a]:this._mapLines[c.LAYOUT_KEY_DEFAULT]},enumerable:!0,configurable:!0}),c.LAYOUT_KEY_DEFAULT="-layout-default",c}();a.GroupProfile=c}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b=function(){function a(){this._status={}}return a.prototype.statusAddRef=function(a){return this._status[a]?this._status[a]++:this._status[a]=1,this._status[a]},a.prototype.statusRelease=function(a){var b;return this._status[a]?(this._status[a]--,b=this._status[a],0===b&&delete this._status[a]):b=0,b},a.prototype.statusScope=function(a,b){this.statusAddRef(a),b(),this.statusRelease(a)},a.prototype.isStatusIn=function(a){return!!this._status[a]},a}();a.StatusManager=b}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b=function(){function a(){this._index=0,this._offset=0,this._height=0,this._lines=[],this._status="inactive"}return a.prototype.activate=function(){"active"!==this._status&&this._lines.forEach(function(a){a.activate()}),this._status="active"},a.prototype.hide=function(){"hidden"!==this._status&&this._lines.forEach(function(a){a.hide()}),this._status="hidden"},a.prototype.inactivate=function(){"inactive"!==this._status&&this._lines.forEach(function(a){a.inactivate()}),this._status="inactive"},a.prototype.push=function(a){this._lines.push(a),this._height+=a.height},a.prototype.normalize=function(){var a=_.every(this._lines,function(a){return a.isActive()});a||(this._status="inactive")},a.prototype.getLineProfile=function(a){return a>=0&&a<this._lines.length?this._lines[a]:null},a.prototype.getLineProfileFirst=function(){return this.getLineProfile(0)},a.prototype.getLineProfileLast=function(){return this.getLineProfile(this._lines.length-1)},Object.defineProperty(a.prototype,"index",{get:function(){return this._index},set:function(a){this._index=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"offset",{get:function(){return this._offset},set:function(a){this._offset=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),a}();a.PageProfile=b}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(b){var c=a.UI._ListViewUtils,d="[CDP.UI.ScrollerElement] ",e=function(){function a(a,b){this._$target=null,this._$scrollMap=null,this._listviewOptions=null,this._$target=$(a),this._listviewOptions=b}return a.prototype.getType=function(){return"element-overflow"},a.prototype.getPos=function(){return this._$target.scrollTop()},a.prototype.getPosMax=function(){return null==this._$scrollMap&&(this._$scrollMap=this._$target.children().first()),c.max(this._$scrollMap.height()-this._$target.height(),0)},a.prototype.on=function(a,b){switch(a){case"scroll":this._$target.on("scroll",b);break;case"scrollstop":this._$target.on("scrollstop",b);break;default:console.warn(d+"unsupported type: "+a)}},a.prototype.off=function(a,b){switch(a){case"scroll":this._$target.off("scroll",b);break;case"scrollstop":this._$target.off("scrollstop",b);break;default:console.warn(d+"unsupported type: "+a)}},a.prototype.scrollTo=function(a,b,c){this._listviewOptions.enableAnimation&&b?(null==c&&(c=this._listviewOptions.animationDuration),this._$target.animate({scrollTop:a},c)):this._$target.scrollTop(a)},a.prototype.update=function(){},a.prototype.destroy=function(){this._$scrollMap=null,this._$target=null},a.getFactory=function(){var b=function(b,c){return new a(b,c)};return b},a}();b.ScrollerElement=e}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(b){var c=a.UI._ListViewUtils,d="[CDP.UI.ScrollerNative] ",e=function(){function a(a){this._$body=null,this._$target=null,this._$scrollMap=null,this._listviewOptions=null,this._$target=$(document),this._$body=$("body"),this._listviewOptions=a}return a.prototype.getType=function(){return"native-scroll"},a.prototype.getPos=function(){return this._$target.scrollTop()},a.prototype.getPosMax=function(){return c.max(this._$target.height()-window.innerHeight,0)},a.prototype.on=function(a,b){switch(a){case"scroll":this._$target.on("scroll",b);break;case"scrollstop":$(window).on("scrollstop",b);break;default:console.warn(d+"unsupported type: "+a)}},a.prototype.off=function(a,b){switch(a){case"scroll":this._$target.off("scroll",b);break;case"scrollstop":$(window).off("scrollstop",b);break;default:console.warn(d+"unsupported type: "+a)}},a.prototype.scrollTo=function(a,b,c){this._listviewOptions.enableAnimation&&b?(null==c&&(c=this._listviewOptions.animationDuration),this._$body.animate({scrollTop:a},c)):this._$body.scrollTop(a)},a.prototype.update=function(){},a.prototype.destroy=function(){this._$scrollMap=null,this._$target=null},a.getFactory=function(){var b=function(b,c){return new a(c)};return b},a}();b.ScrollerNative=e}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(b){var c=a.UI.ListViewGlobalConfig,d=a.UI._ListViewUtils,e="[CDP.UI.ScrollerIScroll] ",f=function(){function a(a,b,c,d){this._$owner=null,this._iscroll=null,this._refreshTimerId=null,this._$wrapper=null,this._$scroller=null,this._listviewOptions=null,null!=IScroll?(this._$owner=a,this._iscroll=new IScroll(b,c),this._$wrapper=$(this._iscroll.wrapper),this._$scroller=$(this._iscroll.scroller),this._listviewOptions=d):console.error(e+"iscroll module doesn't load.")}return a.prototype.getType=function(){return"iscroll"},a.prototype.getPos=function(){var a=this._iscroll.getComputedPosition().y;return a=_.isNaN(a)?0:-a},a.prototype.getPosMax=function(){return d.max(-this._iscroll.maxScrollY,0)},a.prototype.on=function(a,b){switch(a){case"scroll":this._iscroll.on("scroll",b);break;case"scrollstop":this._iscroll.on("scrollEnd",b);break;default:console.warn(e+"unsupported type: "+a)}},a.prototype.off=function(a,b){switch(a){case"scroll":this._iscroll.off("scroll",b);break;case"scrollstop":this._iscroll.on("scrollEnd",b);break;default:console.warn(e+"unsupported type: "+a)}},a.prototype.scrollTo=function(a,b,c){var c=0;this._listviewOptions.enableAnimation&&b&&(c=c||this._listviewOptions.animationDuration),this._iscroll.scrollTo(0,-a,c)},a.prototype.update=function(){var a=this;if(this._$owner){!function(){var b=a._$owner.height();b!==a._$wrapper.height()&&a._$wrapper.height(b)}(),null!=this._refreshTimerId&&clearTimeout(this._refreshTimerId);var b=function(){a._$scroller&&a._$scroller.height()!==a._iscroll.scrollerHeight?(a._iscroll.refresh(),a._refreshTimerId=setTimeout(b,a._listviewOptions.scrollMapRefreshInterval)):a._refreshTimerId=null};this._iscroll.refresh(),this._refreshTimerId=setTimeout(b,this._listviewOptions.scrollMapRefreshInterval)}},a.prototype.destroy=function(){this._$scroller=null,this._$wrapper=null,this._iscroll.destroy(),this._$owner=null},a.getFactory=function(b){var d={scrollX:!1,bounce:!1,mouseWheel:!0,scrollbars:!0,interactiveScrollbars:!0,shrinkScrollbars:"scale",fadeScrollbars:!0,probeType:2},e=$.extend({},d,b),f=function(b,d){var f=$(b),g=f.find(c.SCROLL_MAP_SELECTOR),h=$("<div class='"+c.WRAPPER_CLASS+"'></div>").css({position:"absolute",width:"100%",height:"100%",overflow:"hidden"});return g.wrap(h),new a(f,c.WRAPPER_SELECTOR,e,d)};return f},a}();b.ScrollerIScroll=f}(b=a.UI||(a.UI={}))}(a||(a={}));var a,b=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c};!function(a){var c;!function(a){var c="[CDP.UI.ListItemView] ",d=function(a){function d(b){if(a.call(this,b),this._owner=null,this._lineProfile=null,this._owner=b.owner,b.$el){var c=this.events?!0:!1;this.setElement(b.$el,c)}this._lineProfile=b.lineProfile}return b(d,a),d.prototype.render=function(){return console.warn(c+"need override 'render()' method."),this},d.prototype.getIndex=function(){return this._lineProfile.index},d.prototype.getSpecifiedHeight=function(){return this._lineProfile.height},d.prototype.hasChildNode=function(){return this.$el?0<this.$el.children().length:!1},d.prototype.updateHeight=function(a,b){return this.$el&&this.getSpecifiedHeight()!==a&&(this._lineProfile.updateHeight(a,b),this.$el.height(a)),this},d.prototype.remove=function(){return this.$el.find("figure").css("background-image","none"),this.$el.children().remove(),this.$el.off(),this.$el=null,this.stopListening(),this._lineProfile=null,this},Object.defineProperty(d.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),d}(Backbone.View);a.ListItemView=d}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(b){var c=a.UI.ListViewGlobalConfig,d=a.UI._ListViewUtils,e="[CDP.UI.ScrollManager] ",f=function(){function a(a){var c=this;this._$root=null,this._$map=null,this._mapHeight=0,this._scroller=null,this._settings=null,this._active=!0,this._scrollEventHandler=null,this._scrollStopEventHandler=null,this._baseHeight=0,this._lines=[],this._pages=[],this._lastActivePageContext={index:0,from:0,to:0,pos:0},this._backup={};var d={scrollerFactory:b.ScrollerNative.getFactory(),enableHiddenPage:!1,enableTransformOffset:!1,scrollMapRefreshInterval:200,scrollRefreshDistance:200,pagePrepareCount:3,pagePreloadCount:1,enableAnimation:!0,animationDuration:0,baseDepth:"auto",removeItemWithTransition:!0,useDummyInactiveScrollMap:!1};this._settings=$.extend({},d,a),this._scrollEventHandler=function(){c.onScroll(c._scroller.getPos())},this._scrollStopEventHandler=function(){c.onScrollStop(c._scroller.getPos())}}return a.prototype.initialize=function(a,b){this._$root=a,this._$map=a.hasClass(c.SCROLL_MAP_CLASS)?a:a.find(c.SCROLL_MAP_SELECTOR),this._scroller=this.createScroller(),this.setBaseHeight(b),this.setScrollerCondition()},a.prototype.destroy=function(){this._scroller&&(this.resetScrollerCondition(),this._scroller.destroy(),this._scroller=null),this.release(),this._$map=null,this._$root=null},a.prototype.setBaseHeight=function(a){this._baseHeight=a,this._scroller&&this._scroller.update()},a.prototype.setActiveState=function(a){this._active=a,this.treatScrollPosition()},a.prototype.isActive=function(){return this._active},a.prototype.treatScrollPosition=function(){var a,b=this,c={},e=function(e,f){if(f=f||b._scroller.getPos()-b._lastActivePageContext.pos,d.getCssMatrixValue(e,"translateY")!==f){for(a=0;a<d.cssPrefixes.length;a++)c[d.cssPrefixes[a]+"transform"]="translate3d(0px,"+f+"px,0px)";return e.css(c),e}},f=function(b){for(a=0;a<d.cssPrefixes.length;a++)c[d.cssPrefixes[a]+"transform"]="";return b.css(c),b};this._active?(!function(){b._scroller&&b._scroller.scrollTo(b._lastActivePageContext.pos,!1,0),f(b._$map).show()}(),this._settings.useDummyInactiveScrollMap&&this.prepareInactiveMap().remove()):e(this._settings.useDummyInactiveScrollMap?this.prepareInactiveMap():this._$map)},a.prototype.prepareInactiveMap=function(){var a=this._$map.parent(),b=a.find(c.INACTIVE_CLASS_SELECTOR);if(b.length<=0){var d=this.getPageIndex(),e=this._$map.clone().children().filter(function(a,b){var e=~~$(b).attr(c.DATA_PAGE_INDEX);return e>=d-1||d+1>=e?!0:!1});b=$("<section class='"+c.SCROLL_MAP_CLASS+" "+c.INACTIVE_CLASS+"'></section>").append(e).height(this._mapHeight),a.append(b),this._$map.hide()}return b},a.prototype.isInitialized=function(){return!!this._$root},a.prototype.addItem=function(a,c,d,e){this._addLine(new b.LineProfile(this,Math.floor(a),c,d),e)},a.prototype._addLine=function(a,b){var c,d,e=0,f=a instanceof Array?a:[a],g=!1;for(null==b&&(b=this._lines.length),b===this._lines.length&&(g=!0),c=0,d=f.length;d>c;c++)e+=f[c].height;for(this.updateScrollMapHeight(e),c=f.length-1;c>=0;c--)this._lines.splice(b,0,f[c]);g||(0===b?this.clearPage():null!=this._lines[b-1].pageIndex&&this.clearPage(this._lines[b-1].pageIndex)),this.updateProfiles(b)},a.prototype.removeItem=function(a,b,c){var f=this;if(null==b&&(b=1),0>a||this._lines.length<a+b)return void console.error(e+"logic error. GroupProfile.removeItem(), invalid index: "+a);c=null!=c?c:0;var g=function(a,b){var c=function(){a.off(d.transitionEnd),d.clearTransitions(a)};f._$map.on(d.transitionEnd,c),d.setTransformsTransitions(a,"height",b,"ease")},h=0,i=[],j=!1;!function(){for(var d,e=0;b>e;e++)d=f._lines[a+e],h+=d.height,d.resetDepth(),i.push(d);if(f._settings.removeItemWithTransition&&c>0){var g=f.getScrollPos(),k=f.getScrollPosMax()-h;j=g>k}}(),function(){j&&g(f._$map,c),null!=f._lines[a].pageIndex&&f.clearPage(f._lines[a].pageIndex),f.updateScrollMapHeight(-h),f._lines.splice(a,b),f.updateProfiles(a),setTimeout(function(){i.forEach(function(a){a.inactivate()})},c)}()},a.prototype.getItemInfo=function(a){var b,d=function(a){return a.hasClass(c.LISTITEM_BASE_CLASS)?~~a.attr(c.DATA_CONTAINER_INDEX):a.hasClass(c.SCROLL_MAP_CLASS)||a.length<=0?(console.warn(e+"cannot ditect line from event object."),null):d(a.parent())};return a instanceof $.Event?b=d($(a.currentTarget)):"number"==typeof a&&(b=a),null==b?(console.error(e+"logic error. unsupported arg type. type: "+typeof a),null):0>b||this._lines.length<=b?(console.error(e+"logic error. invalid range. index: "+b),null):this._lines[b].info},a.prototype.refresh=function(){var a=this,b={},c=this._settings.pagePrepareCount+this._settings.pagePreloadCount,f=this.getPageIndex(),g=[],h=_.filter(this._pages,function(a){return"inactive"!==a.status}),i=function(c){c===f?(b[c]="activate",g.push(c)):b[c]=d.abs(f-c)<=a._settings.pagePrepareCount?"activate":a._settings.enableHiddenPage?"hide":"activate",(f+1===c||f-1===c)&&g.push(c)};this._lines.length<=0||(!function(){var b=0,d=0,e=0,g=0,h=f-c,j=f+c;for(d=h;j>=d;d++)0>d?e++:a._pages.length<=d?g++:i(d);if(e>0)for(b=0,d=f+c+1;e>b&&!(a._pages.length<=d);b++,d++)i(d);if(g>0)for(b=0,d=f-c-1;g>b&&!(0>d);b++,d--)i(d)}(),h.forEach(function(a){var c=a.index;null==b[c]&&a.inactivate()}),g.sort(function(a,b){return b>a?-1:a>b?1:0}).forEach(function(b){setTimeout(function(){a.isInitialized()&&a._pages[b]&&a._pages[b].activate()},0)}),_.each(b,function(c,d){setTimeout(function(){if(a.isInitialized()){var f=~~d;switch(c){case"activate":a._pages[f]&&a._pages[f].activate();break;case"hide":a._pages[f]&&a._pages[f].hide();break;case"inactivate":console.warn(e+"unexpected operation: inactivate");break;default:console.warn(e+"unknown operation: "+b[d])}}},0)}),this.findRecycleElements().remove(),this._lastActivePageContext.from=this._pages[f].getLineProfileFirst().index,this._lastActivePageContext.to=this._pages[f].getLineProfileLast().index,this._lastActivePageContext.index=f)},a.prototype.update=function(){var a=this._pages.length;this.assignPage(a),this.refresh()},a.prototype.rebuild=function(){this.clearPage(),this.assignPage(),this.refresh()},a.prototype.release=function(){this._lines.forEach(function(a){a.inactivate()}),this._pages=[],this._lines=[],this._$map&&(this._mapHeight=0,this._$map.height(0))},a.prototype.backup=function(a){return null==this._backup[a]&&(this._backup[a]={lines:this._lines}),!0},a.prototype.restore=function(a,b){return void 0===b&&(b=!0),null==this._backup[a]?!1:(0<this._lines.length&&this.release(),this._addLine(this._backup[a].lines),b&&this.rebuild(),!0)},a.prototype.hasBackup=function(a){return null!=this._backup[a]?!0:!1},a.prototype.clearBackup=function(a){return null==a?(this._backup={},!0):null!=this._backup[a]?(delete this._backup[a],!0):!1},Object.defineProperty(a.prototype,"backupData",{get:function(){return this._backup},enumerable:!0,configurable:!0}),a.prototype.setScrollHandler=function(a,b){this._scroller&&(b?this._scroller.on("scroll",a):this._scroller.off("scroll",a))},a.prototype.setScrollStopHandler=function(a,b){this._scroller&&(b?this._scroller.on("scrollstop",a):this._scroller.off("scrollstop",a))},a.prototype.getScrollPos=function(){return this._scroller?this._scroller.getPos():0},a.prototype.getScrollPosMax=function(){return this._scroller?this._scroller.getPosMax():0},a.prototype.scrollTo=function(a,b,c){this._scroller&&(0>a?(console.warn(e+"invalid position, too small. [pos: "+a+"]"),a=0):this._scroller.getPosMax()<a&&(console.warn(e+"invalid position, too big. [pos: "+a+"]"),a=this._scroller.getPosMax()),this._lastActivePageContext.pos=a,a!==this._scroller.getPos()&&this._scroller.scrollTo(a,b,c))},a.prototype.ensureVisible=function(a,b){var c=this;return 0>a||this._lines.length<=a?void console.warn(e+"ensureVisible(), invalid index, noop. [index: "+a+"]"):this._scroller?void function(){var d,f=c._lines[a],g={partialOK:!0,setTop:!1,animate:c._settings.enableAnimation,time:c._settings.animationDuration,callback:function(){}},h=$.extend({},g,b),i={from:c._scroller.getPos(),to:c._scroller.getPos()+c._baseHeight},j={from:f.offset,to:f.offset+f.height},k=function(){return h.partialOK?j.from<=i.from?i.from<=j.to?!0:!1:j.from<=i.to?!0:!1:i.from<=j.from&&j.to<=i.to?!0:!1},l=function(){return j.from<i.from?j.from:i.from<j.from?f.offset-f.height:(console.warn(e+"logic error."),0)};if(h.setTop)d=j.from;else{if(k())return void h.callback();d=l()}0>d?d=0:c._scroller.getPosMax()<d&&(d=c._scroller.getPosMax()),setTimeout(h.callback,h.time),c.scrollTo(d,h.animate,h.time)}():void console.warn(e+"scroller is not ready.")},a.prototype.getScrollMapHeight=function(){return this._$map?this._mapHeight:0},a.prototype.updateScrollMapHeight=function(a){this._$map&&(this._mapHeight+=a,this._mapHeight<0&&(this._mapHeight=0),this._$map.height(this._mapHeight))},a.prototype.updateProfiles=function(a){var b,c,d;for(b=a,c=this._lines.length;c>b;b++)b>0?(d=this._lines[b-1],this._lines[b].index=d.index+1,this._lines[b].offset=d.offset+d.height):(this._lines[b].index=0,this._lines[b].offset=0)},a.prototype.getScrollMapElement=function(){return this._$map||$("")},a.prototype.findRecycleElements=function(){return this._$map?this._$map.find(c.RECYCLE_CLASS_SELECTOR):$("")},a.prototype.getListViewOptions=function(){return this._settings},a.prototype.setScrollerCondition=function(){this._scroller.on("scroll",this._scrollEventHandler),this._scroller.on("scrollstop",this._scrollStopEventHandler)},a.prototype.resetScrollerCondition=function(){this._scroller.off("scrollstop",this._scrollStopEventHandler),this._scroller.off("scroll",this._scrollEventHandler)},a.prototype.createScroller=function(){return this._settings.scrollerFactory(this._$root[0],this._settings)},a.prototype.getPageIndex=function(){var a,b,c,d=this,f=this._scroller?this._scroller.getPos():0,g=this._scroller?this._scroller.getPosMax():0,h=function(){var a=d.getLastPage();return null!=a?a.offset+a.height:d._baseHeight}(),i=function(){return 0===g||g<=d._baseHeight?0:f*h/g}(),j=Math.floor(i/this._baseHeight),k=function(a){return null==a?!1:a.offset<=i&&i<=a.offset+a.height?!0:!1};if(this._pages.length<=j&&(j=this._pages.length-1),c=this._pages[j],k(c))return c.index;if(i<c.offset){for(a=j-1;a>=0;a--)if(c=this._pages[a],k(c))return c.index;return console.warn(e+"unknown page index."),0}for(a=j+1,b=this._pages.length;b>a;a++)if(c=this._pages[a],k(c))return c.index;return console.warn(e+"unknown page index."),this.getLastPage().index},a.prototype.onScroll=function(a){if(this._active&&0<this._pages.length){var b=this.getPageIndex();d.abs(a-this._lastActivePageContext.pos)<this._settings.scrollRefreshDistance&&this._lastActivePageContext.index!==b&&this.refresh(),this._lastActivePageContext.pos=a}},a.prototype.onScrollStop=function(a){if(this._active&&0<this._pages.length){var b=this.getPageIndex();this._lastActivePageContext.index!==b&&this.refresh(),this._lastActivePageContext.pos=a}},a.prototype.getLastPage=function(){return 0<this._pages.length?this._pages[this._pages.length-1]:null},a.prototype.assignPage=function(a){var c,d,e=this;null==a?a=0:this.clearPage(a),function(){var a,f,g=0,h=e.getLastPage();null==h?(h=new b.PageProfile,e._pages.push(h)):(a=h.getLineProfileLast(),null!=a&&(g=a.index+1));var i=e._lines.slice(g);for(c=0,d=i.length;d>c;c++)e._baseHeight<=h.height&&(h.normalize(),f=h,f=new b.PageProfile,f.index=h.index+1,f.offset=h.offset+h.height,h=f,e._pages.push(h)),i[c].pageIndex=h.index,h.push(i[c]);h.normalize()}(),this._scroller&&this._scroller.update()},a.prototype.clearPage=function(a){null==a&&(a=0),this._pages=this._pages.slice(0,a)},a}();b.ScrollManager=f}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var c;!function(a){var c=function(c){function d(b){if(c.call(this,b),this._scrollMgr=null,this._scrollMgr=new a.ScrollManager(b),b.$el){var d=this.events?!0:!1;this.setElement(b.$el,d)}}return b(d,c),d.prototype.setElement=function(a,b){if(this._scrollMgr){var d=$(a);this._scrollMgr.destroy(),this._scrollMgr.initialize(d,d.height())}return c.prototype.setElement.call(this,a,b)},d.prototype.remove=function(){return this._scrollMgr.destroy(),c.prototype.remove.call(this)},d.prototype.isInitialized=function(){return this._scrollMgr.isInitialized()},d.prototype.addItem=function(b,c,d,e){this._addLine(new a.LineProfile(this,Math.floor(b),c,d),e)},d.prototype._addLine=function(a,b){this._scrollMgr._addLine(a,b)},d.prototype.removeItem=function(a,b,c){this._scrollMgr.removeItem(a,b,c)},d.prototype.getItemInfo=function(a){return this._scrollMgr.getItemInfo(a)},d.prototype.refresh=function(){this._scrollMgr.refresh()},d.prototype.update=function(){this._scrollMgr.update()},d.prototype.rebuild=function(){this._scrollMgr.rebuild()},d.prototype.release=function(){this._scrollMgr.release()},d.prototype.backup=function(a){return this._scrollMgr.backup(a)},d.prototype.restore=function(a,b){return void 0===b&&(b=!0),this._scrollMgr.restore(a,b)},d.prototype.hasBackup=function(a){return this._scrollMgr.hasBackup(a)},d.prototype.clearBackup=function(a){return this._scrollMgr.clearBackup(a)},Object.defineProperty(d.prototype,"backupData",{get:function(){return this._scrollMgr.backupData},enumerable:!0,configurable:!0}),d.prototype.setScrollHandler=function(a,b){this._scrollMgr.setScrollHandler(a,b)},d.prototype.setScrollStopHandler=function(a,b){this._scrollMgr.setScrollStopHandler(a,b)},d.prototype.getScrollPos=function(){return this._scrollMgr.getScrollPos()},d.prototype.getScrollPosMax=function(){return this._scrollMgr.getScrollPosMax()},d.prototype.scrollTo=function(a,b,c){this._scrollMgr.scrollTo(a,b,c)},d.prototype.ensureVisible=function(a,b){this._scrollMgr.ensureVisible(a,b)},d.prototype.getScrollMapHeight=function(){return this._scrollMgr.getScrollMapHeight()},d.prototype.updateScrollMapHeight=function(a){this._scrollMgr.updateScrollMapHeight(a)},d.prototype.updateProfiles=function(a){this._scrollMgr.updateProfiles(a)},d.prototype.getScrollMapElement=function(){return this._scrollMgr.getScrollMapElement();

},d.prototype.findRecycleElements=function(){return this._scrollMgr.findRecycleElements()},d.prototype.getListViewOptions=function(){return this._scrollMgr.getListViewOptions()},d}(Backbone.View);a.ListView=c}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var c;!function(a){var c=function(a){function c(b){a.call(this,b),this._groupProfile=null,this._groupProfile=b.groupProfile}return b(c,a),c.prototype.isExpanded=function(){return this._groupProfile.isExpanded()},c.prototype.isExpanding=function(){return this.owner.isExpanding()},c.prototype.isCollapsing=function(){return this.owner.isCollapsing()},c.prototype.isSwitching=function(){return this.owner.isSwitching()},c.prototype.hasChildren=function(a){return this._groupProfile.hasChildren(a)},c}(a.ListItemView);a.GroupListItemView=c}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b="[CDP.UI.ExpandManager] ",c=function(){function c(a){this._owner=null,this._mapGroups={},this._aryTopGroups=[],this._layoutKey=null,this._owner=a}return c.prototype.newGroup=function(b){var c;return null==b&&(b="group-id:"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)),null!=this._mapGroups[b]?this._mapGroups[b]:(c=new a.GroupProfile(b,this._owner),this._mapGroups[b]=c,c)},c.prototype.getGroup=function(a){return null==this._mapGroups[a]?(console.warn(b+"group id: "+a+" is not registered."),null):this._mapGroups[a]},c.prototype.registerTopGroup=function(a){var c,d;return"registered"===a.status?void a.restore():(c=0<this._aryTopGroups.length?this._aryTopGroups[this._aryTopGroups.length-1]:null,d=null!=c?c.getLastLineIndex(!0)+1:0,_.isNaN(d)?void console.error(b+"logic error, 'insertTo' is NaN."):(this._aryTopGroups.push(a),void a.register(d)))},c.prototype.getTopGroups=function(){return this._aryTopGroups.slice(0)},c.prototype.expandAll=function(){this._aryTopGroups.forEach(function(a){a.hasChildren()&&a.expand()})},c.prototype.collapseAll=function(a){this._aryTopGroups.forEach(function(b){b.hasChildren()&&b.collapse(a)})},c.prototype.isExpanding=function(){return this._owner.isStatusIn("expanding")},c.prototype.isCollapsing=function(){return this._owner.isStatusIn("collapsing")},c.prototype.isSwitching=function(){return this.isExpanding()||this.isCollapsing()},c.prototype.statusAddRef=function(a){return this._owner.statusAddRef(a)},c.prototype.statusRelease=function(a){return this._owner.statusRelease(a)},c.prototype.statusScope=function(a,b){this._owner.statusScope(a,b)},c.prototype.isStatusIn=function(a){return this._owner.isStatusIn(a)},Object.defineProperty(c.prototype,"layoutKey",{get:function(){return this._layoutKey},set:function(a){this._layoutKey=a},enumerable:!0,configurable:!0}),c.prototype.release=function(){this._mapGroups={},this._aryTopGroups=[]},c.prototype.backup=function(a){var b=this.backupData;return null==b[a]&&(b[a]={map:this._mapGroups,tops:this._aryTopGroups}),!0},c.prototype.restore=function(a,b){void 0===b&&(b=!0);var c=this.backupData;return null==c[a]?!1:(0<this._aryTopGroups.length&&this.release(),this._mapGroups=c[a].map,this._aryTopGroups=c[a].tops,this._aryTopGroups.length<=0||!this._aryTopGroups[0].hasLayoutKeyOf(this.layoutKey)?!1:(this._aryTopGroups.forEach(function(a){a.restore()}),b&&this._owner.rebuild(),!0))},c.prototype.hasBackup=function(a){return this._owner.hasBackup(a)},c.prototype.clearBackup=function(a){return this._owner.clearBackup(a)},Object.defineProperty(c.prototype,"backupData",{get:function(){return this._owner.backupData},enumerable:!0,configurable:!0}),c}();a.ExpandManager=c}(b=a.UI||(a.UI={}))}(a||(a={}));var a;return function(a){var c;!function(a){var c=function(c){function d(b){c.call(this,b),this._statusMgr=null,this._expandManager=null,this._statusMgr=new a.StatusManager,this._expandManager=new a.ExpandManager(this)}return b(d,c),d.prototype.newGroup=function(a){return this._expandManager.newGroup(a)},d.prototype.getGroup=function(a){return this._expandManager.getGroup(a)},d.prototype.registerTopGroup=function(a){this._expandManager.registerTopGroup(a)},d.prototype.getTopGroups=function(){return this._expandManager.getTopGroups()},d.prototype.expandAll=function(){this._expandManager.expandAll()},d.prototype.collapseAll=function(a){this._expandManager.collapseAll(a)},d.prototype.isExpanding=function(){return this._expandManager.isExpanding()},d.prototype.isCollapsing=function(){return this._expandManager.isCollapsing()},d.prototype.isSwitching=function(){return this._expandManager.isSwitching()},d.prototype.statusAddRef=function(a){return this._statusMgr.statusAddRef(a)},d.prototype.statusRelease=function(a){return this._statusMgr.statusRelease(a)},d.prototype.statusScope=function(a,b){this._statusMgr.statusScope(a,b)},d.prototype.isStatusIn=function(a){return this._statusMgr.isStatusIn(a)},Object.defineProperty(d.prototype,"layoutKey",{get:function(){return this._expandManager.layoutKey},set:function(a){this._expandManager.layoutKey=a},enumerable:!0,configurable:!0}),d.prototype.release=function(){c.prototype.release.call(this),this._expandManager.release()},d.prototype.backup=function(a){return this._expandManager.backup(a)},d.prototype.restore=function(a,b){return void 0===b&&(b=!0),this._expandManager.restore(a,b)},d}(a.ListView);a.ExpandableListView=c}(c=a.UI||(a.UI={}))}(a||(a={})),a.UI});
//# sourceMappingURL=cdp.ui.listview-0.3.0.min.map