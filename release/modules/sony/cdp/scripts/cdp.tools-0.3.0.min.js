/* CDP-Template 2015-03-31 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore"],function(){return b(a.CDP||(a.CDP={}))}):b(a.CDP||(a.CDP={}))}(this,function(a){a.Tools=a.Tools||{};var a;!function(a){var b;!function(a){a.global=a.global||window}(b=a.Tools||(a.Tools={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b="[CDP.Tools.AsyncProc] ",c=function(){function a(){this._canceled=!1}return a.prototype.postMessage=function(){this._canceled=!1},a.prototype.terminate=function(){this._canceled=!0},a.prototype.onProcess=function(){console.warn(b+"onProcess(), need override this method.")},a.prototype.onFinish=function(){console.warn(b+"onFinish(), need override this method.")},a.prototype.onError=function(){console.warn(b+"onError(), need override this method.")},a.prototype.isCanceled=function(){return this._canceled},a.prototype.addEventListener=function(){console.warn(b+"AsyncProc.addEventListener() is not supported.")},a.prototype.removeEventListener=function(){console.warn(b+"AsyncProc.removeEventListener() is not supported.")},a.prototype.dispatchEvent=function(){return console.warn(b+"AsyncProc.dispatchEvent() is not supported."),!1},a}();a.AsyncProc=c;var d=function(){function a(){}return a.asyncProcArray=function(a,b,c){var d=b.concat(),e=function(){var b=new Date;a&&a.isCanceled()&&c.finishHandler.call(a,!0,c.info);try{for(;;){a&&a.isCanceled()&&c.finishHandler.call(a,!0,c.info);var f=d.shift();if(c.processHandler.call(a,f,c.info),d.length<=0)return void c.finishHandler.call(a,!1,c.info);if((new Date).getTime()-b.getTime()>100)break}setTimeout(e,0)}catch(g){c.errorHandler.call(a,g,c.info)}};setTimeout(e,0)},a}();a.AsyncProcUtil=d}(b=a.Tools||(a.Tools={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b;!function(b){function c(){return a.global.BlobBuilder||a.global.WebKitBlobBuilder||a.global.MozBlobBuilder||a.global.MSBlobBuilder}function d(b,d){var e=null,f=c();if(null!=f){var g=new f;g.append(b),e=g.getBlob(d)}else e=new a.global.Blob([b],{type:d});return e}function e(b,d){var e=null,g=c();if(null!=g){var h=new g;h.append(f(b)),e=h.getBlob(d)}else e=new a.global.Blob([f(b)],{type:d});return e}function f(a){for(var b=window.atob(a),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0,f=b.length;f>e;++e)d[e]=b.charCodeAt(e);return c}function g(a){for(var b=window.atob(a),c=new Uint8Array(b.length),d=0,e=b.length;e>d;++d)c[d]=b.charCodeAt(d);return c}function h(a){var b=new Uint8Array(a);return this.uint8ArrayToBase64(b)}function i(a){for(var b="",c=0,d=a.byteLength;d>c;++c)b+=String.fromCharCode(a[c]);return window.btoa(b)}b.arrayBufferToBlob=d,b.base64ToBlob=e,b.base64ToArrayBuffer=f,b.base64ToUint8Array=g,b.arrayBufferToBase64=h,b.uint8ArrayToBase64=i,b.URL=function(){return a.global.URL||a.global.webkitURL}()}(b=a.Blob||(a.Blob={}))}(b=a.Tools||(a.Tools={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b="[CDP.Tools.DateTime] ",c=function(){function a(){}return a.computeDate=function(a,b){var c=new Date(a.getTime()),d=c.getTime(),e=864e5*b,f=d+e;return c.setTime(f),c},a.convertISOStringToDate=function(a){var b,c,d,e=a.split("T"),f=e[0].split("-");return e[1]&&(b=e[1].split(":"),c=b[2].split(".")),d=b?new Date(f[0],f[1]-1,f[2],b[0],b[1],c[0],c[1]):f[2]?new Date(f[0],f[1]-1,f[2]):f[1]?new Date(f[0],f[1]-1):new Date(f[0])},a.convertDateToISOString=function(c,d){void 0===d&&(d="msec");var e;switch(d){case"year":case"month":case"date":case"hour":case"min":case"sec":case"msec":break;default:console.warn(b+"unknown target: "+d),d="msec"}return e=c.getFullYear(),"year"===d?e:(e+="-"+a.numberToDoubleDigitsString(c.getMonth()+1),"month"===d?e:(e+="-"+a.numberToDoubleDigitsString(c.getDate()),"date"===d?e:(e+="T"+a.numberToDoubleDigitsString(c.getHours()),"hour"===d?e:(e+=":"+a.numberToDoubleDigitsString(c.getMinutes()),"min"===d?e:(e+=":"+a.numberToDoubleDigitsString(c.getSeconds()),"sec"===d?e:e+="."+String((c.getMilliseconds()/1e3).toFixed(3)).slice(2,5))))))},a.convertFileSystemStringToDate=function(a){var b,c,d=a.split("T"),e=d[0].split("_");return d[1]&&(b=d[1].split("_")),c=b?new Date(e[0],e[1]-1,e[2],b[0],b[1],b[2],b[3]):e[2]?new Date(e[0],e[1]-1,e[2]):e[1]?new Date(e[0],e[1]-1):new Date(e[0])},a.convertDateToFileSystemString=function(c,d){void 0===d&&(d="msec");var e;switch(d){case"year":case"month":case"date":case"hour":case"min":case"sec":case"msec":break;default:console.warn(b+"unknown target: "+d),d="msec"}return e=c.getFullYear(),"year"===d?e:(e+="_"+a.numberToDoubleDigitsString(c.getMonth()+1),"month"===d?e:(e+="_"+a.numberToDoubleDigitsString(c.getDate()),"date"===d?e:(e+="T"+a.numberToDoubleDigitsString(c.getHours()),"hour"===d?e:(e+="_"+a.numberToDoubleDigitsString(c.getMinutes()),"min"===d?e:(e+="_"+a.numberToDoubleDigitsString(c.getSeconds()),"sec"===d?e:e+="_"+String((c.getMilliseconds()/1e3).toFixed(3)).slice(2,5))))))},a.numberToDoubleDigitsString=function(a){return 0>a||a>100?null:10>a?"0"+a:""+a},a}();a.DateTime=c}(b=a.Tools||(a.Tools={}))}(a||(a={}));var a;!function(a){var b;!function(a){function b(a){return a>=0?a:-a}function c(a,b){return a>=b?a:b}function d(a,b){return b>=a?a:b}function e(a,b){void 0===b&&(b=0);var c=$.Deferred(),d=function(){a()?c.resolve():setTimeout(d,b)};return setTimeout(d,b),c.promise()}function f(b,c){var d="";return b=Number(b),isNaN(b)||isNaN(c)||0>=c?null:(0>b&&(b=a.abs(b),d="-"),d+(Array(c).join("0")+b).slice(-c))}function g(a,b){function c(){this.constructor=a}var d=a.prototype;c.prototype=b.prototype,a.prototype=new c,$.extend(a.prototype,d)}function h(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];b.forEach(function(b){Object.getOwnPropertyNames(b.prototype).forEach(function(c){a.prototype[c]=b.prototype[c]})})}function i(){var a,b=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;return null==window.devicePixelRatio||b?window.matchMedia?(a="(-webkit-min-device-pixel-ratio: 1.5),\r\n					(min--moz-device-pixel-ratio: 1.5),\r\n					(-o-min-device-pixel-ratio: 3/2),\r\n					(min-resolution: 1.5dppx)",window.matchMedia(a).matches?1.5:(a="(-webkit-min-device-pixel-ratio: 2),\r\n					(min--moz-device-pixel-ratio: 2),\r\n					(-o-min-device-pixel-ratio: 2/1),\r\n					(min-resolution: 2dppx)",window.matchMedia(a).matches?2:(a="(-webkit-min-device-pixel-ratio: 0.75),\r\n					(min--moz-device-pixel-ratio: 0.75),\r\n					(-o-min-device-pixel-ratio: 3/4),\r\n					(min-resolution: 0.75dppx)",window.matchMedia(a).matches?.7:void 0))):1:window.devicePixelRatio}function j(a,b){var c=$.Deferred();if(!a)return c.reject("null argument");var d;switch(typeof a){case"object":d=a;break;case"string":try{d=new Worker(a)}catch(e){return console.error(k+e),c.reject(e)}break;default:return c.reject("invalid type argument")}return d.onerror=function(a){return c.reject(a)},d.onmessage=function(a){return c.resolve(a.data)},d.postMessage(b),c.promise()}var k="[CDP.Tools.Functions] ";a.abs=b,a.max=c,a.min=d,a.await=e,a.toZeroPadding=f,a.inherit=g,a.mixin=h,a.getDevicePixcelRatio=i,a.doWork=j}(b=a.Tools||(a.Tools={}))}(a||(a={}));var a;!function(a){var b;!function(a){function b(a,b){var c=function(b){var c=b?b:{message:"abort"};null!=this.dependency?(this.dependency.abort?this.dependency.abort(c):console.error(d+"[call] dependency object doesn't have 'abort()' method."),this.callReject&&"pending"===this.state()&&a.reject(c)):"pending"===this.state()&&a.reject(c)},e=function(a){var b=this;return a.abort?(this.dependency=a,a.always(function(){b.dependency=null})):console.error(d+"[set] dependency object doesn't have 'abort()' method."),a},f=$.extend({},{dependency:null,callReject:!1},b),g=a.promise(f);return null==g.abort&&(g.abort=c.bind(g)),null==g.dependOn&&(g.dependOn=e.bind(g)),g}function c(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=_.flatten(a),d=$.Deferred(),e=[],f=!1,g=function(){return f?!_.some(e,function(a){return"pending"===a.status}):!1};return c.forEach(function(a,b){e.push({status:"pending",args:null}),a.then(function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];e[b].status="resolved",e[b].args=a},function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];e[b].status="rejected",e[b].args=a}).always(function(){g()&&d.resolve(e)})}),f=!0,g()&&d.resolve(e),d.promise()}var d="[CDP.Tools.Promise] ";a.makePromise=b,a.wait=c;var e=function(){function a(){this._pool=[],this._id=0}return a.prototype.add=function(a){var b=this;if(null==a)return null;if(!a.abort)return console.error(d+"[add] promise object doesn't have 'abort()' method."),a;var c={promise:a,id:this._id++};return this._pool.push(c),a.always(function(){b._pool=_.reject(b._pool,function(a){return a.id===c.id?!0:!1})}),a},a.prototype.cancel=function(a){var b=this.promises();return _.each(b,function(b){b.abort&&b.abort(a)}),c.apply(null,b)},a.prototype.promises=function(){return _.pluck(this._pool,"promise")},a}();a.PromiseManager=e}(b=a.Tools||(a.Tools={}))}(a||(a={}));var a;return function(a){var b;!function(a){var b="[CDP.Tools.Template] ",c=function(){function c(){}return c.getTemplateElement=function(a,d){var e=c.getElementMap(),f=e[a];try{if(!f){if(d){var g=c.findHtmlFromSource(d);f=$(g).find(a)}else f=$(a);if(0>=f)throw"invalid [key, src] = ["+a+", "+d+"]";e[a]=f}}catch(h){return console.error(b+h),null}return f},c.empty=function(){c._mapElement=null,c._mapSource=null},c.getJST=function(b,c){var d,e=this.getTemplateElement(b,c),f=null;return null!=a.global.Hogan?(f=Hogan.compile(e.text()),d=function(a){return f.render(a)}):(f=_.template(e.html()),d=function(a){return f(a).replace(/\n|\t/g,"")}),d},c.getElementMap=function(){return c._mapElement||(c._mapElement={}),c._mapElement},c.getSourceMap=function(){return c._mapSource||(c._mapSource={}),c._mapSource},c.findHtmlFromSource=function(a){var b=c.getSourceMap(),d=b[a];return d||($.ajax({url:a,method:"GET",async:!1,dataType:"html",success:function(a){d=a},error:function(a,b){throw"ajax request failed. status: "+b}}),b[a]=d),d},c}();a.Template=c}(b=a.Tools||(a.Tools={}))}(a||(a={})),a.Tools});
//# sourceMappingURL=cdp.tools-0.3.0.min.map